<!DOCTYPE html>
<html>
<head>
    <title>üé§ –ì–æ–ª–æ—Å–æ–≤–æ–π —á–∞—Ç –¥–ª—è –¥—Ä—É–∑–µ–π (GitHub)</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #0f172a; color: #f8fafc; min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .container { background: #1e293b; border-radius: 20px; padding: 30px; width: 100%; max-width: 500px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); border: 1px solid #334155; }
        h1 { text-align: center; color: #60a5fa; margin-bottom: 25px; font-size: 28px; }
        .screen { display: none; }
        .screen.active { display: block; }
        input, button { width: 100%; padding: 15px; margin: 12px 0; border-radius: 12px; font-size: 16px; border: none; }
        input { background: #334155; color: white; border: 2px solid #475569; }
        input:focus { outline: none; border-color: #60a5fa; box-shadow: 0 0 0 3px rgba(96,165,250,0.2); }
        button { background: linear-gradient(135deg, #3b82f6, #8b5cf6); color: white; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        button:hover { transform: translateY(-3px); box-shadow: 0 7px 20px rgba(59,130,246,0.4); }
        button:disabled { background: #475569; cursor: not-allowed; transform: none; }
        .btn-copy { background: linear-gradient(135deg, #10b981, #34d399); }
        .btn-leave { background: linear-gradient(135deg, #ef4444, #f87171); }
        .status { padding: 15px; text-align: center; border-radius: 10px; margin: 20px 0; font-weight: bold; }
        .online { background: rgba(34,197,94,0.2); border: 2px solid #22c55e; color: #86efac; }
        .offline { background: rgba(239,68,68,0.2); border: 2px solid #ef4444; color: #fca5a5; }
        .users { background: #334155; padding: 20px; border-radius: 15px; margin: 25px 0; min-height: 200px; border: 1px solid #475569; }
        .user { padding: 12px; background: #1e293b; margin: 10px 0; border-radius: 8px; border-left: 4px solid #60a5fa; display: flex; justify-content: space-between; align-items: center; }
        .link-box { background: #334155; padding: 20px; border-radius: 15px; margin: 25px 0; word-break: break-all; border: 1px solid #475569; }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0; }
        .mic-on { background: linear-gradient(135deg, #22c55e, #4ade80); }
        .mic-off { background: linear-gradient(135deg, #ef4444, #f87171); }
        .mic-on, .mic-off { padding: 15px; font-size: 18px; }
        .connection-status { font-size: 14px; color: #94a3b8; margin-top: 10px; text-align: center; }
        .talking { border-left-color: #22c55e !important; background: rgba(34,197,94,0.1) !important; }
        #remoteAudio { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <!-- –≠–∫—Ä–∞–Ω –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
        <div id="connectScreen" class="screen active">
            <h1>üé§ –ì–æ–ª–æ—Å–æ–≤–æ–π —á–∞—Ç –¥–ª—è –¥—Ä—É–∑–µ–π</h1>
            <p style="color: #cbd5e1; margin-bottom: 30px; text-align: center;">–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–Ω–∞—Ç—É –∏ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–≥–∞ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –æ–±—â–µ–Ω–∏—è!</p>
            <input type="text" id="username" placeholder="–í–∞—à–µ –∏–º—è" value="–î—Ä—É–≥">
            <input type="text" id="roomId" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã" value="–∫–æ–º–Ω–∞—Ç–∞">
            <button onclick="joinRoom()" id="joinBtn">‚úÖ –í–æ–π—Ç–∏ –≤ –∫–æ–º–Ω–∞—Ç—É</button>
            <div class="status offline" id="status">–ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏ –≤ –∫–æ–º–Ω–∞—Ç—É"</div>
            <p style="color: #86efac; text-align: center; font-size: 14px; margin-top: 25px; padding: 12px; background: rgba(34,197,94,0.1); border-radius: 8px; border: 1px solid #22c55e;">
                ‚úÖ GitHub Pages + HTTPS = –º–∏–∫—Ä–æ—Ñ–æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç!
            </p>
        </div>

        <!-- –≠–∫—Ä–∞–Ω —á–∞—Ç–∞ -->
        <div id="chatScreen" class="screen">
            <h1>üé§ <span id="roomTitle">–ö–æ–º–Ω–∞—Ç–∞</span></h1>
            <div class="users">
                <h3 style="margin-bottom: 15px; color: #cbd5e1;">üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏ (<span id="userCount">0</span>):</h3>
                <div id="userList"></div>
            </div>
            <div class="connection-status" id="connectionInfo">
                <span id="audioStatus">üîÑ –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</span>
            </div>
            <div class="controls">
                <button id="micBtn" class="mic-on" onclick="toggleMic()">üé§ –ú–∏–∫—Ä–æ—Ñ–æ–Ω –í–∫–ª</button>
                <button class="btn-copy" onclick="copyLink()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
            </div>
            <div class="link-box">
                <strong style="color: #60a5fa;">üîó –û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –¥—Ä—É–≥—É:</strong><br><br>
                <span id="inviteLink" style="color: #cbd5e1;">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <button class="btn-leave" onclick="leaveRoom()">üö™ –ü–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
        </div>
    </div>

    <!-- PeerJS –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ -->
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    
    <script>
        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
        let currentRoom = '';
        let currentUser = '';
        let localStream = null;
        let isMuted = false;
        let myPeer = null;
        let connections = {}; // {peerId: connection}
        let users = {}; // {peerId: {name, isSpeaking}}

        // ==================== –§–£–ù–ö–¶–ò–ò ====================

        // –í–æ–π—Ç–∏ –≤ –∫–æ–º–Ω–∞—Ç—É
        async function joinRoom() {
            currentUser = document.getElementById('username').value.trim() || '–î—Ä—É–≥';
            currentRoom = document.getElementById('roomId').value.trim() || '–∫–æ–º–Ω–∞—Ç–∞';

            const joinBtn = document.getElementById('joinBtn');
            joinBtn.disabled = true;
            joinBtn.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
            updateStatus('üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É...', false);

            try {
                // 1. –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –º–∏–∫—Ä–æ—Ñ–æ–Ω
                localStream = await navigator.mediaDevices.getUserMedia({
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        autoGainControl: true
                    }
                });
                updateStatus('‚úÖ –ú–∏–∫—Ä–æ—Ñ–æ–Ω –ø–æ–¥–∫–ª—é—á–µ–Ω!', true);

                // 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º PeerJS
                await initPeerJS();

                // 3. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —á–∞—Ç–∞
                document.getElementById('connectScreen').classList.remove('active');
                document.getElementById('chatScreen').classList.add('active');
                document.getElementById('roomTitle').textContent = currentRoom;

                // 4. –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É
                const baseUrl = window.location.href.split('?')[0];
                const inviteUrl = `${baseUrl}?room=${encodeURIComponent(currentRoom)}&join=true`;
                document.getElementById('inviteLink').textContent = inviteUrl;

                // 5. –î–æ–±–∞–≤–ª—è–µ–º —Å–µ–±—è –≤ —Å–ø–∏—Å–æ–∫
                addUser(myPeer.id, currentUser);
                updateStatus('‚úÖ –ì–æ—Ç–æ–≤ –∫ –æ–±—â–µ–Ω–∏—é!', true);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                joinBtn.disabled = false;
                joinBtn.textContent = '‚úÖ –í–æ–π—Ç–∏ –≤ –∫–æ–º–Ω–∞—Ç—É';
                
                if (error.name === 'NotAllowedError') {
                    alert('‚ùå –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É!');
                    updateStatus('‚ùå –ú–∏–∫—Ä–æ—Ñ–æ–Ω –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', false);
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                    updateStatus('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', false);
                }
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PeerJS
        async function initPeerJS() {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–º–Ω–∞—Ç—ã –∏ –∏–º–µ–Ω–∏
            const peerId = `room-${currentRoom}-user-${currentUser}-${Date.now()}`;
            
            myPeer = new Peer(peerId, {
                host: '0.peerjs.com',
                port: 443,
                path: '/',
                secure: true,
                config: {
                    iceServers: [
                        { urls: 'stun:stun.l.google.com:19302' },
                        { urls: 'stun:stun1.l.google.com:19302' },
                        { urls: 'stun:stun2.l.google.com:19302' }
                    ]
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ PeerJS
            myPeer.on('open', (id) => {
                console.log('‚úÖ PeerJS –ø–æ–¥–∫–ª—é—á–µ–Ω, ID:', id);
                updateStatus('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É PeerJS', true);
                
                // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –¥—Ä—É–≥–∏–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –∫–æ–º–Ω–∞—Ç—ã
                connectToOtherUsers();
            });

            myPeer.on('connection', (conn) => {
                console.log('üìû –í—Ö–æ–¥—è—â–µ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Ç:', conn.peer);
                setupConnection(conn);
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                conn.on('data', (data) => {
                    if (data.type === 'user-info') {
                        addUser(conn.peer, data.name);
                        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–≤–æ—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–±—Ä–∞—Ç–Ω–æ
                        conn.send({
                            type: 'user-info',
                            name: currentUser
                        });
                    }
                });
            });

            myPeer.on('call', (call) => {
                console.log('üìû –í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫ –æ—Ç:', call.peer);
                call.answer(localStream);
                
                call.on('stream', (remoteStream) => {
                    console.log('‚úÖ –ü–æ–ª—É—á–µ–Ω —É–¥–∞–ª–µ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ –æ—Ç:', call.peer);
                    playRemoteAudio(remoteStream, call.peer);
                });
                
                call.on('close', () => {
                    console.log('‚ùå –ó–≤–æ–Ω–æ–∫ –∑–∞–∫—Ä—ã—Ç:', call.peer);
                    removeUser(call.peer);
                });
                
                connections[call.peer] = call;
            });

            myPeer.on('error', (err) => {
                console.error('PeerJS –æ—à–∏–±–∫–∞:', err);
                if (err.type === 'peer-unavailable') {
                    updateStatus('‚ö†Ô∏è –î—Ä—É–≥ –µ—â–µ –Ω–µ –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è', true);
                }
            });
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤ –∫–æ–º–Ω–∞—Ç–µ
        function connectToOtherUsers() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            // –î–ª—è –¥–µ–º–æ –ø—Ä–æ—Å—Ç–æ –∂–¥–µ–º –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
            updateConnectionInfo('üîÑ –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥—Ä—É–≥–∞...');
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏
        function setupConnection(conn) {
            conn.on('open', () => {
                console.log('‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Å:', conn.peer);
                
                // –û–±–º–µ–Ω–∏–≤–∞–µ–º—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
                conn.send({
                    type: 'user-info',
                    name: currentUser
                });
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
                const call = myPeer.call(conn.peer, localStream);
                
                call.on('stream', (remoteStream) => {
                    console.log('‚úÖ –ü–æ–ª—É—á–µ–Ω —É–¥–∞–ª–µ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ –æ—Ç:', conn.peer);
                    playRemoteAudio(remoteStream, conn.peer);
                });
                
                connections[conn.peer] = call;
                updateConnectionInfo('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ! –ì–æ–≤–æ—Ä–∏—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ');
            });
            
            conn.on('close', () => {
                console.log('‚ùå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ:', conn.peer);
                removeUser(conn.peer);
            });
        }

        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –∞—É–¥–∏–æ
        function playRemoteAudio(stream, peerId) {
            // –°–æ–∑–¥–∞–µ–º —Å–∫—Ä—ã—Ç—ã–π –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç
            const audio = new Audio();
            audio.srcObject = stream;
            audio.autoplay = true;
            audio.volume = 1.0;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            if (!users[peerId]) users[peerId] = {};
            users[peerId].audio = audio;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            updateUserStatus(peerId, 'connected');
        }

        // –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–ø–∏—Å–æ–∫
        function addUser(peerId, userName) {
            if (!users[peerId]) {
                users[peerId] = {
                    name: userName,
                    status: 'connecting',
                    peerId: peerId
                };
                updateUserList();
            }
        }

        // –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function removeUser(peerId) {
            if (users[peerId]) {
                delete users[peerId];
                
                if (connections[peerId]) {
                    connections[peerId].close();
                    delete connections[peerId];
                }
                
                updateUserList();
                updateConnectionInfo('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª—é—á–∏–ª—Å—è');
            }
        }

        // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function updateUserList() {
            const userList = document.getElementById('userList');
            const userCount = document.getElementById('userCount');
            
            userList.innerHTML = '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–µ–±—è
            const selfItem = document.createElement('div');
            selfItem.className = 'user';
            selfItem.innerHTML = `
                <span><strong>${currentUser}</strong> <span style="color: #60a5fa;">(–í—ã)</span></span>
                <span style="color: ${isMuted ? '#f87171' : '#4ade80'}">
                    ${isMuted ? 'üîá –í—ã–∫–ª' : 'üé§ –í–∫–ª'}
                </span>
            `;
            userList.appendChild(selfItem);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            Object.values(users).forEach(user => {
                if (user.peerId !== myPeer.id) {
                    const userItem = document.createElement('div');
                    userItem.className = 'user';
                    userItem.innerHTML = `
                        <span><strong>${user.name}</strong></span>
                        <span style="color: ${user.status === 'connected' ? '#22c55e' : '#94a3b8'}">
                            ${user.status === 'connected' ? '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω' : 'üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...'}
                        </span>
                    `;
                    userList.appendChild(userItem);
                }
            });
            
            userCount.textContent = Object.keys(users).length;
        }

        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function updateUserStatus(peerId, status) {
            if (users[peerId]) {
                users[peerId].status = status;
                updateUserList();
            }
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏
        function updateConnectionInfo(message) {
            document.getElementById('audioStatus').textContent = message;
            
            const connectedCount = Object.values(users).filter(u => u.status === 'connected').length - 1;
            if (connectedCount > 0) {
                document.getElementById('connectionInfo').style.color = '#22c55e';
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω
        function toggleMic() {
            if (!localStream) return;
            
            isMuted = !isMuted;
            localStream.getAudioTracks()[0].enabled = !isMuted;
            
            const micBtn = document.getElementById('micBtn');
            if (isMuted) {
                micBtn.textContent = 'üîá –ú–∏–∫—Ä–æ—Ñ–æ–Ω –í—ã–∫–ª';
                micBtn.className = 'mic-off';
                updateStatus('üîá –ú–∏–∫—Ä–æ—Ñ–æ–Ω –≤—ã–∫–ª—é—á–µ–Ω', true);
            } else {
                micBtn.textContent = 'üé§ –ú–∏–∫—Ä–æ—Ñ–æ–Ω –í–∫–ª';
                micBtn.className = 'mic-on';
                updateStatus('üé§ –ú–∏–∫—Ä–æ—Ñ–æ–Ω –≤–∫–ª—é—á–µ–Ω', true);
            }
            
            updateUserList();
        }

        function updateStatus(msg, isOk) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = msg;
            statusEl.className = `status ${isOk ? 'online' : 'offline'}`;
        }

        function copyLink() {
            const link = document.getElementById('inviteLink').textContent;
            navigator.clipboard.writeText(link).then(() => {
                updateStatus('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!', true);
            });
        }

        function leaveRoom() {
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            Object.values(connections).forEach(conn => conn.close());
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Ç–æ–∫
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
            }
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º Peer
            if (myPeer) {
                myPeer.destroy();
            }
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é
            document.getElementById('chatScreen').classList.remove('active');
            document.getElementById('connectScreen').classList.add('active');
            
            const joinBtn = document.getElementById('joinBtn');
            joinBtn.disabled = false;
            joinBtn.textContent = '‚úÖ –í–æ–π—Ç–∏ –≤ –∫–æ–º–Ω–∞—Ç—É';
            
            updateStatus('–û—Ç–∫–ª—é—á–µ–Ω–æ', false);
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            currentRoom = '';
            currentUser = '';
            localStream = null;
            isMuted = false;
            myPeer = null;
            connections = {};
            users = {};
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const roomFromUrl = urlParams.get('room');
            if (roomFromUrl) {
                document.getElementById('roomId').value = roomFromUrl;
            }
            
            updateStatus('‚úÖ –°–∞–π—Ç –Ω–∞ HTTPS ‚Äî –º–∏–∫—Ä–æ—Ñ–æ–Ω –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å!', true);
        };

        window.onbeforeunload = leaveRoom;
    </script>
</body>
</html>
